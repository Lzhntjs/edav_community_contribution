<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Introduction to geographic chart in R</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit inherit; background-repeat: inherit inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit inherit; background-repeat: inherit inherit; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print { 
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; background-position: initial initial; background-repeat: initial initial; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; background-position: initial initial; background-repeat: initial initial; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); background-position: initial initial; background-repeat: initial initial; }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print { 
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


/* for resume  <-- */
#write {
    padding-top: 0px !important;
    padding-bottom: 20px !important;
}

content {
    margin-top: 0px !important;
    padding-top: 0px !important;
}

a {
    color: #000;
}

h1,
h2 {
    border-bottom: 1px solid #eee !important;
    margin-bottom: 3px !important;
    padding-bottom: 3px !important;
}

h2 img {
    width: 16px !important;
}

h2 {
    font-size: 17px !important;
}

p {
    margin-bottom: 2px !important;
    margin-top: 2px !important;
}

ul {
    margin-top: 2px !important;
    margin-bottom: 2px !important;
}

li p {
    margin-bottom: 0px !important;
}

li.md-list-item {
    line-height: 20px !important;
}

a {
    color: #555 !important;
}

/* for resume --> */

:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
    margin: 0 auto;
    padding: 30px;
    padding-bottom: 100px;
}

#write>ul:first-child,
#write>ol:first-child {
    margin-top: 30px;
}

a {
    color: #4183C4;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit;
}

h2 tt,
h2 code {
    font-size: inherit;
}

h3 tt,
h3 code {
    font-size: inherit;
}

h4 tt,
h4 code {
    font-size: inherit;
}

h5 tt,
h5 code {
    font-size: inherit;
}

h6 tt,
h6 code {
    font-size: inherit;
}

h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}

h2 {
    padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}

h4 {
    font-size: 1.25em;
}

h5 {
    font-size: 1em;
}

h6 {
    font-size: 1em;
    color: #777;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li>ol,
li>ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}

blockquote blockquote {
    padding-right: 0;
}

table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0, 28, 36, .3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item>input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

.md-fences {
    background-color: #f8f8f8;
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
    bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before {
    left: -1.5625rem;
    top: .375rem;
}

#write>h4.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write>h5.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write>h6.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc {
    margin-top: 20px;
    padding-bottom: 20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}


</style>
</head>
<body class='typora-export'>
<div id='write'  class=''><h3><a name="introduction-to-geographic-chart-in-r" class="md-header-anchor"></a><span>Introduction to geographic chart in R</span></h3><h3><a name="zihao-liu" class="md-header-anchor"></a><span>Zihao Liu</span></h3><h3><a name="uni-zl2986" class="md-header-anchor"></a><span>UNI: zl2986</span></h3><h4><a name="11-basic-conceptions" class="md-header-anchor"></a><span>1.1 Basic conceptions</span></h4><p><span>Our data in the real world often contains geographic location information, so it is inevitable to draw maps involving geographic coordinate systems. The geographic coordinate system uses a three-dimensional sphere to define the position of the earth&#39;s surface, so as to realize a coordinate system that references points on the earth&#39;s surface through latitude and longitude.</span></p><p><span>Spatial data refers to data defined in a three-dimensional space with geographic location information. Map projection is a particularly important key technology. The most basic step of map information visualization is map projection, which converts the geographic coordinate information on the non-expandable surface to a two-dimensional plane, which is equivalent to surface parameterization.</span></p><p><span>Projection can be divided into many types. In practical applications, we should choose the projection method that best meets the target according to different needs. Among them, the most commonly used projection methods are：</span></p><ul><li><span>Azimuthal or Zenithal projection</span></li><li><span>Spherical or equirectangular projection</span></li><li><span>Orthographic projection</span></li><li><span>Lambert&#39;s equal-area meridional map projection</span></li><li><span>Albers projection</span></li></ul><h4><a name="12-choropleth-map" class="md-header-anchor"></a><span>1.2 Choropleth map</span></h4><p><span>A </span><strong><span>choropleth map</span></strong><span>  is a type of thematic map in which a set of pre-defined areas is colored or patterned in  proportion to a statistical variable that represents an aggregate  summary of a geographic characteristic within each area, such as population density or per-capita income. Choropleth maps provide an easy way to visualize how a variable varies  across a geographic area or show the level of variability within a  region.</span></p><p><span>The final element of a choropleth map is the set of colors used to represent the different values of the variable.The most common types of color progressions used in choropleth (and other thematic) maps include:</span></p><ul><li><span>Single hue progression</span></li><li><span>Bi-polar color progression</span></li><li><span>Full-spectral color progression</span></li></ul><p><span>The biggest problem with choropleth maps is the asymmetry of data distribution and geographic area size. Usually a large amount of data is concentrated in densely populated areas, while sparsely populated areas occupies most of the screen space. The practice of using a large amount of screen space to represent a small part of data is very uneconomical in the use of space. This asymmetry often results It causes users to misunderstand the data and cannot help users accurately distinguish and compare the data values of each area on the map. Therefore, sometimes other geospatial charts can be used to represent regional data more reasonably, such as hexagonal maps.</span></p><h6><a name="making-choropleth-maps" class="md-header-anchor"></a><span>Making choropleth maps</span></h6><p><span>The key to drawing a Choropleth map is to map the values of different regions to the colors of different regions or polygons. Therefore, the map database and the data frame containing the countries and their values must be joined. This can be done using the left-Join()  function of the dplyr package. Based on their shared columns &#39;country&#39;,  use ggplot&#39;s geom_polygon() to draw areas of different colors.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">rgdal</span>) &nbsp; <span class="cm-comment">#for readOGR()</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">------------------------</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map1.shp"</span>)</span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedDF</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span><span class="cm-string">'id'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>, <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"id"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_City.csv"</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">left_join</span>(<span class="cm-variable">df_Map</span>, <span class="cm-variable">df_city</span>[<span class="cm-variable">c</span>(<span class="cm-string">'country'</span>,<span class="cm-string">'orange'</span>)], <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"country"</span>)</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(a) Single hue progression</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">orange</span>),<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">country</span>),<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_fill_gradientn</span>(<span class="cm-variable">colours</span> <span class="cm-operator">=</span> <span class="cm-variable">rev</span>(<span class="cm-variable">brewer.pal</span>(<span class="cm-number">9</span>,<span class="cm-string">'YlGnBu'</span>)))<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">theme</span>(<span class="cm-variable">legend.position</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">0.9</span>,<span class="cm-number">0.2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">legend.background</span> <span class="cm-operator">=</span> <span class="cm-variable">element_blank</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(b) Bi-polar color progression</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre></div><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">orange</span>),<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">country</span>),<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_fill_gradient2</span>(<span class="cm-variable">low</span><span class="cm-operator">=</span><span class="cm-string">"#00A08A"</span>,<span class="cm-variable">mid</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">high</span><span class="cm-operator">=</span><span class="cm-string">"#FF0000"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">midpoint</span> <span class="cm-operator">=</span> <span class="cm-variable">mean</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orange</span>))<span class="cm-operator">+</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">theme</span>(<span class="cm-variable">legend.position</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">0.9</span>,<span class="cm-number">0.2</span>),</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">legend.background</span> <span class="cm-operator">=</span> <span class="cm-variable">element_blank</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 704px;"></div><div class="CodeMirror-gutters" style="display: none; height: 704px;"></div></div></div></pre><p>&nbsp;</p><center class="half">
    <img src="/Users/liuzihao/MSDS/stat5702/cc/picture/iShot2021-03-07 22.15.45.png" alt="iShot2021-03-07 22.15.45" width="300">
    <img src="/Users/liuzihao/MSDS/stat5702/cc/picture/iShot2021-03-07 22.14.40.png" alt="iShot2021-03-07 22.14.40" width="300">
 </center><p><span>                                  (a)Single hue progression                              (b)     Bi-polar color progression</span></p><h4><a name="13-dot-map" class="md-header-anchor"></a><span>1.3 Dot map</span></h4><p><span>Dot map, also called dot distribution map or dot density map, is a method using dots with same size to illustrate the data distribution on a geographic map. The items on the dot map contains longitude and latitude rather than size information. Dot map is an ideal way to observe the geographic distribution. However, when it comes to the specific items and its data, dot map is not proper. </span></p><p><span>There are two common types:</span></p><ul><li><strong><span>One-to-one</span></strong><span>: one dot only represents one item because the location of the dot only has one data source to make sure the dot is located at the correct place.</span></li><li><strong><span>One-to-many</span></strong><span>: one dot represents a special unit, not the specific location because the dot here is collection data which put on the map randomly.</span></li></ul><h6><a name="making-dot-maps" class="md-header-anchor"></a><span>Making dot maps</span></h6><p><span>Dot map is a combination of dots and a map. The kay is to translate the location data (x, y) to longitude and latitude data (long, lat). </span><strong><span>Figure a</span></strong><span> illustrates a basic dot map with dots and texts. Firstly, make map layer by using </span><strong><span>geom_polygon()</span></strong><span> function, then use </span><strong><span>geom_point()</span></strong><span> function to make dots, and then use </span><strong><span>geom_text</span></strong><span> function to add texts. </span><strong><span>Figure b</span></strong><span> employs text boxes on a dot map by using </span><strong><span>df_map</span></strong><span> and </span><strong><span>df_city</span></strong><span>.</span></p><p><span>Bubble map is a combination of dot map and bubbles. It requires data (lat, long, value) to make bubbles on a map. In this method, longitude and latitude can show the geographic location and value stands for the size of bubbles. Sometimes we can distinguish the data with different colors by using another dimension-catergory. However, we need to pay more attention on the bubbles when the bubbles are too many or too large, otherwise the bubbles will overlap.</span></p><p><span>Similar to dot map, bubble map only adds new variables to illustrate size and color. </span><strong><span>Figure c</span></strong><span> is a common bubble map, while </span><strong><span>Figure d</span></strong><span> uses different color to distinguish data and therefore get a more straightforward plot.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">rgdal</span>) &nbsp; <span class="cm-comment">#readOGR()</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map1.shp"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>, <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"id"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_City.csv"</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(a) （point）+（text）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'white'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>),<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'red'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">4</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">city</span>),<span class="cm-variable">vjust</span><span class="cm-operator">=</span><span class="cm-number">1.5</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(b) （label）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'white'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#geom_point(data=df_city,aes(x=long, y=lat),shape=21,fill='red',colour="black",size=4)+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_label</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">city</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'orange'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><center class="half">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308190424505.png" alt="image-20210308190424505" width="300">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308190524706.png" alt="image-20210308190524706" width="300">
 </center><p><span>                                   (a) point + text                                                       (b) label</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map1.shp"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedDF</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span><span class="cm-string">'id'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(c) represent by size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'white'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-variable">orange</span>),<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'#EF5439'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">city</span>),<span class="cm-variable">vjust</span><span class="cm-operator">=</span><span class="cm-number">2</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_size</span>(<span class="cm-variable">range</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-number">2</span>,<span class="cm-number">9</span>),<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'price'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(d) represent by size and color of bubble</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'white'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-variable">orange</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">orange</span>),<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">city</span>),<span class="cm-variable">vjust</span><span class="cm-operator">=</span><span class="cm-number">2</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_size</span>(<span class="cm-variable">range</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-number">2</span>,<span class="cm-number">9</span>),<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'price'</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_fill_gradientn</span>(<span class="cm-variable">colours</span> <span class="cm-operator">=</span> <span class="cm-variable">brewer.pal</span>(<span class="cm-number">9</span>,<span class="cm-string">'YlOrRd'</span>),<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'price'</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><center class="half">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308190717569.png" alt="image-20210308190717569" width="300">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308190806440.png" alt="image-20210308190806440" width="300">
 </center><p><span>                                   (c)     bubble size                                         (d) bubble size and color</span></p><h4><a name="14-pie-map" class="md-header-anchor"></a><span>1.4 Pie map</span></h4><p><span>Pie map is a combination of pie chart and map. By using pie map, we can easily tell the proportion of different values in a given area. And different colors can also help distinguish different categories.</span></p><p><span>Both </span><strong><span>geom_scatterpi</span></strong><span>e function from scatterpie package and </span><strong><span>geom_arc_bar()</span></strong><span> function from ggforce package can be used to draw pie map, which requires the coordinate system as coord_fixed() type to make sure that x-axis and y-axis have the same minimized unit. </span><strong><span>Figure a</span></strong><span> and </span><strong><span>Figure b</span></strong><span> are typical pie maps while Figure b employs bubble map to show the size of each value at the same time.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">rgdal</span>) &nbsp; <span class="cm-comment">#readOGR()</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">reshape2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">scatterpie</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#library(wesanderson)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map1.shp"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedDF</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span><span class="cm-string">'id'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>, <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"id"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_City.csv"</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Map_Scale</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-number">0.75</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_lat</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">min</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span>) <span class="cm-comment">#30.11628</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">max_lat</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">max</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span>) <span class="cm-comment">#59.94186</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_long</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">min</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span>) <span class="cm-comment">#105.2945</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">max_long</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">max</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span>) <span class="cm-comment">#134.8317</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">x</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">y</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">*</span><span class="cm-variable">Map_Scale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">x</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">y</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">*</span><span class="cm-variable">Map_Scale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">labels_x</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">seq</span>(<span class="cm-number">110</span>,<span class="cm-number">135</span>,<span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">breaks_x</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">labels_x</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">labels_y</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">seq</span>(<span class="cm-number">30</span>,<span class="cm-number">60</span>,<span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">breaks_y</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">labels_y</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Sumindex</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">rowSums</span>(<span class="cm-variable">df_city</span>[,<span class="cm-variable">c</span>(<span class="cm-string">"orange"</span>,<span class="cm-string">"apple"</span>,<span class="cm-string">"banana"</span>,<span class="cm-string">"watermelon"</span>)])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Bubble_Scale</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-number">0.04</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">radius</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">sqrt</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Sumindex</span><span class="cm-operator">/</span><span class="cm-variable">pi</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Max_radius</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">max</span>(<span class="cm-variable">radius</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">radius</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">radius</span><span class="cm-operator">/</span><span class="cm-variable">Max_radius</span><span class="cm-operator">*</span><span class="cm-variable">Bubble_Scale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(a) pie map with scatter</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'white'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_scatterpie</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">city</span>,<span class="cm-variable">r</span><span class="cm-operator">=</span><span class="cm-number">0.03</span>),<span class="cm-comment"># 0.03</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cols</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-string">"orange"</span>,<span class="cm-string">"apple"</span>,<span class="cm-string">"banana"</span>,<span class="cm-string">"watermelon"</span>), <span class="cm-variable">color</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>, <span class="cm-variable">alpha</span><span class="cm-operator">=</span><span class="cm-number">1</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_x_continuous</span>(<span class="cm-variable">breaks</span><span class="cm-operator">=</span><span class="cm-variable">breaks_x</span>,<span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable">labels_x</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_y_continuous</span>(<span class="cm-variable">breaks</span><span class="cm-operator">=</span><span class="cm-variable">breaks_y</span>,<span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable">labels_y</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">xlab</span>(<span class="cm-string">"long"</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ylab</span>(<span class="cm-string">"lat"</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">coord_fixed</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(b) pie map with complex bubble </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'white'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_scatterpie</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">city</span>,<span class="cm-variable">r</span><span class="cm-operator">=</span><span class="cm-variable">radius</span>),<span class="cm-comment"># 0.03</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cols</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-string">"orange"</span>,<span class="cm-string">"apple"</span>,<span class="cm-string">"banana"</span>,<span class="cm-string">"watermelon"</span>), <span class="cm-variable">color</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>, <span class="cm-variable">alpha</span><span class="cm-operator">=</span><span class="cm-number">1</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_scatterpie_legend</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">radius</span>, <span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-number">0.9</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">n</span><span class="cm-operator">=</span><span class="cm-number">5</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">labeller</span><span class="cm-operator">=</span><span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">round</span>((<span class="cm-variable">x</span><span class="cm-operator">*</span> <span class="cm-variable">Max_radius</span><span class="cm-operator">/</span><span class="cm-variable">Bubble_Scale</span>)<span class="cm-operator">^</span><span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">pi</span>))<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_x_continuous</span>(<span class="cm-variable">breaks</span><span class="cm-operator">=</span><span class="cm-variable">breaks_x</span>,<span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable">labels_x</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_y_continuous</span>(<span class="cm-variable">breaks</span><span class="cm-operator">=</span><span class="cm-variable">breaks_y</span>,<span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable">labels_y</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">xlab</span>(<span class="cm-string">"long"</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ylab</span>(<span class="cm-string">"lat"</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">coord_fixed</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1320px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1320px;"></div></div></div></pre><center class="half">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308191523937.png" alt="image-20210308191523937" width="300">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308191634351.png" alt="image-20210308191634351" width="300">
 </center><p><span>                                            (a)pie map with scatter                      (b) pie map with bubbles</span></p><h4><a name="15-bar-map" class="md-header-anchor"></a><span>1.5 bar map</span></h4><p><span>Bar map is the overlap of two layers: map and bar chart. The height of bars represents values. And it can also be divided by colors (</span><strong><span>Figure a</span></strong><span>). </span><strong><span>Figure b</span></strong><span> employs coxcomb in its bars.</span></p><p><span>To draw rectangle, we can use </span><strong><span>geom_rect()</span></strong><span> function from ggplot2 package. So we only need to set the value of coordinates of rectangles: (xmin, ymin) and (xmax, ymax), then use geom_rect() function to realize the bars.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ibrary</span>(<span class="cm-variable">rgdal</span>) &nbsp; <span class="cm-comment">#readOGR()</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map1.shp"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedDF</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span><span class="cm-string">'id'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>, <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"id"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_City.csv"</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">selectCol</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">c</span>(<span class="cm-string">"orange"</span>,<span class="cm-string">"apple"</span>,<span class="cm-string">"banana"</span>,<span class="cm-string">"watermelon"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">MaxH</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">max</span>(<span class="cm-variable">df_city</span>[,<span class="cm-variable">selectCol</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Scale</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">width</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-number">1.1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span>[,<span class="cm-variable">selectCol</span>]<span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">df_city</span>[,<span class="cm-variable">selectCol</span>]<span class="cm-operator">/</span><span class="cm-variable">MaxH</span><span class="cm-operator">*</span><span class="cm-variable">Scale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">melt</span>(<span class="cm-variable">df_city</span>[<span class="cm-variable">c</span>(<span class="cm-string">'lat'</span>,<span class="cm-string">'long'</span>,<span class="cm-string">'group'</span>,<span class="cm-string">'city'</span>,<span class="cm-variable">selectCol</span>)],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">id.vars</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-string">'lat'</span>,<span class="cm-string">'long'</span>,<span class="cm-string">'group'</span>,<span class="cm-string">'city'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">transform</span>(<span class="cm-variable">df_city</span>,<span class="cm-variable">hjust1</span><span class="cm-operator">=</span><span class="cm-variable">ifelse</span>(<span class="cm-variable">variable</span><span class="cm-operator">==</span><span class="cm-string">'orange'</span>,<span class="cm-operator">-</span><span class="cm-variable">width</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">ifelse</span>(<span class="cm-variable">variable</span><span class="cm-operator">==</span><span class="cm-string">'apple'</span>,<span class="cm-operator">-</span><span class="cm-variable">width</span><span class="cm-operator">/</span><span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">ifelse</span>(<span class="cm-variable">variable</span><span class="cm-operator">==</span><span class="cm-string">'banana'</span>,<span class="cm-number">0</span>,<span class="cm-variable">width</span><span class="cm-operator">/</span><span class="cm-number">2</span>))),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hjust2</span><span class="cm-operator">=</span><span class="cm-variable">ifelse</span>(<span class="cm-variable">variable</span><span class="cm-operator">==</span><span class="cm-string">'orange'</span>,<span class="cm-operator">-</span><span class="cm-variable">width</span><span class="cm-operator">/</span><span class="cm-number">2</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">ifelse</span>(<span class="cm-variable">variable</span><span class="cm-operator">==</span><span class="cm-string">'apple'</span>,<span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ifelse</span>(<span class="cm-variable">variable</span><span class="cm-operator">==</span><span class="cm-string">'banana'</span>,<span class="cm-variable">width</span><span class="cm-operator">/</span><span class="cm-number">2</span>,<span class="cm-variable">width</span>))))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Lengend_data</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">data.frame</span>(<span class="cm-variable">X</span><span class="cm-operator">=</span><span class="cm-variable">rep</span>(<span class="cm-number">132</span>,<span class="cm-number">5</span>),<span class="cm-variable">Y</span><span class="cm-operator">=</span><span class="cm-variable">rep</span>(<span class="cm-number">32</span>,<span class="cm-number">5</span>),<span class="cm-variable">index</span><span class="cm-operator">=</span><span class="cm-variable">seq</span>(<span class="cm-number">0</span>,<span class="cm-variable">MaxH</span>,<span class="cm-variable">MaxH</span><span class="cm-operator">/</span><span class="cm-number">4</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(a) bar map</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_rect</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">df_city</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">xmin</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span> <span class="cm-operator">+</span><span class="cm-variable">hjust1</span>, <span class="cm-variable">xmax</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span><span class="cm-operator">+</span><span class="cm-variable">hjust2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ymin</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>, <span class="cm-variable">ymax</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span> <span class="cm-operator">+</span> <span class="cm-variable">value</span> ,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">fill</span><span class="cm-operator">=</span> <span class="cm-variable">variable</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">size</span> <span class="cm-operator">=</span><span class="cm-number">0.25</span>, <span class="cm-variable">colour</span> <span class="cm-operator">=</span><span class="cm-string">"black"</span>, <span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>[<span class="cm-operator">!</span><span class="cm-variable">duplicated</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">city</span>),],<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span><span class="cm-operator">-</span><span class="cm-number">0.5</span>,<span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">city</span>),<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">4</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">labs</span>(<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'type'</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_rect</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">Lengend_data</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">xmin</span> <span class="cm-operator">=</span> <span class="cm-variable">X</span> , <span class="cm-variable">xmax</span> <span class="cm-operator">=</span> <span class="cm-variable">X</span><span class="cm-operator">+</span><span class="cm-number">0.5</span> ,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">ymin</span> <span class="cm-operator">=</span> <span class="cm-variable">Y</span>, <span class="cm-variable">ymax</span> <span class="cm-operator">=</span> <span class="cm-variable">Y</span><span class="cm-operator">+</span><span class="cm-variable">index</span> <span class="cm-operator">/</span> <span class="cm-variable">MaxH</span> <span class="cm-operator">*</span> <span class="cm-variable">Scale</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">size</span> <span class="cm-operator">=</span><span class="cm-number">0.25</span>, <span class="cm-variable">colour</span> <span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">fill</span> <span class="cm-operator">=</span> <span class="cm-atom">NA</span>,<span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">Lengend_data</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">X</span><span class="cm-operator">+</span><span class="cm-number">1.5</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span> &nbsp;<span class="cm-variable">Y</span><span class="cm-operator">+</span><span class="cm-variable">index</span> <span class="cm-operator">/</span> <span class="cm-variable">MaxH</span> <span class="cm-operator">*</span> <span class="cm-variable">Scale</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">index</span>),<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(b) coxcomb map</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Map_Scale</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-number">0.75</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_lat</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">min</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span>) <span class="cm-comment">#30.11628</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">max_lat</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">max</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span>) <span class="cm-comment">#59.94186</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_long</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">min</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span>) <span class="cm-comment">#105.2945</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">max_long</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">max</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span>) <span class="cm-comment">#134.8317</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">x</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">y</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_Map</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">*</span><span class="cm-variable">Map_Scale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">x</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">y</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">*</span><span class="cm-variable">Map_Scale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">labels_x</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">seq</span>(<span class="cm-number">110</span>,<span class="cm-number">135</span>,<span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">breaks_x</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">labels_x</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_long</span><span class="cm-operator">-</span><span class="cm-variable">min_long</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">labels_y</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">seq</span>(<span class="cm-number">30</span>,<span class="cm-number">60</span>,<span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">breaks_y</span><span class="cm-operator cm-arrow">&lt;-</span>(<span class="cm-variable">labels_y</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)<span class="cm-operator">/</span>(<span class="cm-variable">max_lat</span><span class="cm-operator">-</span><span class="cm-variable">min_lat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">r</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-number">0.05</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scale</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">r</span><span class="cm-operator">/</span><span class="cm-variable">max</span>(<span class="cm-variable">sqrt</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">value</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">start</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">rep</span>(<span class="cm-variable">c</span>(<span class="cm-number">0</span>,<span class="cm-number">90</span>,<span class="cm-number">180</span>,<span class="cm-number">270</span>)<span class="cm-operator">/</span><span class="cm-number">180</span><span class="cm-operator">*</span><span class="cm-variable">pi</span>,<span class="cm-variable">each</span><span class="cm-operator">=</span><span class="cm-variable">nrow</span>(<span class="cm-variable">df_city</span>)<span class="cm-operator">/</span><span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">end</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">start</span><span class="cm-operator">+</span><span class="cm-variable">pi</span><span class="cm-operator">/</span><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_Map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">x</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">y</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_arc_bar</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x0</span><span class="cm-operator">=</span><span class="cm-variable">x</span>,<span class="cm-variable">y0</span><span class="cm-operator">=</span><span class="cm-variable">y</span>,<span class="cm-variable">r0</span><span class="cm-operator">=</span><span class="cm-number">0</span>,<span class="cm-variable">r</span><span class="cm-operator">=</span><span class="cm-variable">sqrt</span>(<span class="cm-variable">value</span>)<span class="cm-operator">*</span><span class="cm-variable">scale</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">start</span><span class="cm-operator">=</span><span class="cm-variable">start</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">end</span><span class="cm-operator">=</span><span class="cm-variable">end</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">variable</span>),<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">geom_text</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span>[<span class="cm-operator">!</span><span class="cm-variable">duplicated</span>(<span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">city</span>),],<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>,<span class="cm-variable">label</span><span class="cm-operator">=</span><span class="cm-variable">city</span>),<span class="cm-variable">vjust</span><span class="cm-operator">=</span><span class="cm-number">2.3</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">3</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">labs</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-string">'long'</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-string">'lat'</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'type'</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_x_continuous</span>(<span class="cm-variable">breaks</span><span class="cm-operator">=</span><span class="cm-variable">breaks_x</span>,<span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable">labels_x</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_y_continuous</span>(<span class="cm-variable">breaks</span><span class="cm-operator">=</span><span class="cm-variable">breaks_y</span>,<span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable">labels_y</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">coord_fixed</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1628px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1628px;"></div></div></div></pre><center class="half">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308192242886.png" alt="image-20210308192242886" width="300">
<img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308192352571.png" alt="image-20210308192352571" width="300">
 </center><p><span>                                       (a) bar map                                              (b)coxcomb map</span></p><h4><a name="16-voronoi-map" class="md-header-anchor"></a><span>1.6 Voronoi map</span></h4><p><span>Voronoi diagram (also known as Dirichlet tessellation, Dirichlet tessellation) is a space division algorithm established by Russian mathematician Georgi Voronoi. The inspiration comes from Descartes&#39; idea of dividing space with convex domains.  It is a continuous polygon composed of a set of vertical bisectors linking two adjacent points. N points that are distinct on the plane, divide the plane according to the nearest neighbor principle; each point is associated with its nearest area.</span></p><p><span>Simply put, when we see a series of given points in space, such as x, y1, y2, y3, we want to delineate an area surrounding this point for each point, such as x, such as area Cx. This cx containing x can be called a voronoi cell. For any point located in cx, such as px, we always want it to be the distance from point x to all other given points. For example, the distance of y1, y2, and y3.</span></p><p><span>In practice, we can link each point with some neighboring points, and connect them with one line segment after another. For this line segment, we can make its vertical bisector (if it is three-dimensional, it is the vertical bisector), These vertical bisectors will enclose an area, such an area is a cell.</span></p><p><span>Vornoi map can be seen as the map that has more limitation of area on Vornoi diagram.</span></p><h6><a name="choropleth-maps-drawing" class="md-header-anchor"></a><span>Choropleth maps drawing</span></h6><p><span>The realization of the map requires the spatial geographic location data of the scattered points from the data format of SpatialPointsDataFrame, and then use SPointDF_to_voronoi_SPolyDF() to generate a Voronoi diagram in SpatialPolygonsDataFrame format.</span></p><p><span>After that, use the intersect() function in the raster package to obtain the overlapping areas of the Voronoi diagram and different countries and regions one by one, so as to obtain the Voronoi map</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Reference:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#https://gis.stackexchange.com/questions/140504/extracting-intersection-areas-in-r</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#https://www.codesd.com/item/fill-the-voronoi-polygons-with-ggplot.html</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">sp</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">deldir</span>) <span class="cm-comment">#deldir()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">raster</span>) <span class="cm-comment">#intersect()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map0.shp"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_map</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>, <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"id"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_City.csv"</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dati</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">data.frame</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span>,<span class="cm-variable">z</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orange</span>,<span class="cm-variable">city</span><span class="cm-operator">=</span><span class="cm-variable">df_city</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">city</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">vor_pts</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SpatialPointsDataFrame</span>(<span class="cm-variable">cbind</span>(<span class="cm-variable">dati</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">x</span>,<span class="cm-variable">dati</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">y</span>),<span class="cm-variable">dati</span>, <span class="cm-variable">match.ID</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">SPointsDF_to_voronoi_SPolysDF</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-keyword">function</span>(<span class="cm-variable">sp</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># tile.list extracts the polygon data from the deldir computation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vor_desc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">tile.list</span>(<span class="cm-variable">deldir</span>(<span class="cm-variable">sp</span>@<span class="cm-variable">coords</span>[,<span class="cm-number">1</span>], <span class="cm-variable">sp</span>@<span class="cm-variable">coords</span>[,<span class="cm-number">2</span>],<span class="cm-variable">rw</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-number">105</span>,<span class="cm-number">135</span>,<span class="cm-number">30</span>,<span class="cm-number">60</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">lapply</span>(<span class="cm-number">1</span><span class="cm-operator">:</span>(<span class="cm-variable">length</span>(<span class="cm-variable">vor_desc</span>)), <span class="cm-keyword">function</span>(<span class="cm-variable">i</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># tile.list gets us the points for the polygons but we</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># still have to close them, hence the need for the rbind</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">tmp</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cbind</span>(<span class="cm-variable">vor_desc</span>[[<span class="cm-variable">i</span>]]<span class="cm-operator cm-dollar">$</span><span class="cm-variable">x</span>, <span class="cm-variable">vor_desc</span>[[<span class="cm-variable">i</span>]]<span class="cm-operator cm-dollar">$</span><span class="cm-variable">y</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">tmp</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rbind</span>(<span class="cm-variable">tmp</span>, <span class="cm-variable">tmp</span>[<span class="cm-number">1</span>,])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># now we can make the Polygon(s)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Polygons</span>(<span class="cm-builtin">list</span>(<span class="cm-variable">Polygon</span>(<span class="cm-variable">tmp</span>)), <span class="cm-variable">ID</span><span class="cm-operator">=</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }) <span class="cm-operator cm-arrow">-&gt;</span> <span class="cm-variable">vor_polygons</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># hopefully the caller passed in good metadata!</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">sp_dat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">sp</span>@<span class="cm-variable">data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># this way the IDs _should_ match up w/the data &amp; voronoi polys</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">rownames</span>(<span class="cm-variable">sp_dat</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">sapply</span>(<span class="cm-variable">slot</span>(<span class="cm-variable">SpatialPolygons</span>(<span class="cm-variable">vor_polygons</span>),<span class="cm-string">'polygons'</span>),<span class="cm-variable">slot</span>, <span class="cm-string">'ID'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">SpatialPolygonsDataFrame</span>(<span class="cm-variable">SpatialPolygons</span>(<span class="cm-variable">vor_polygons</span>),<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">sp_dat</span>)}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">vor</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SPointsDF_to_voronoi_SPolysDF</span>(<span class="cm-variable">vor_pts</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(a) voronoi diagram</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">vor</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">vor</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_vor</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">vor</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_vor</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">df_vor</span>, <span class="cm-variable">vor</span>@<span class="cm-variable">data</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span><span class="cm-string">'id'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_vor</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">city</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">color</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>, <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">1</span>,<span class="cm-variable">alpha</span><span class="cm-operator">=</span><span class="cm-number">0.4</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">dati</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>), <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">4</span>, <span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>, <span class="cm-variable">color</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>, <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"red"</span>, <span class="cm-variable">stroke</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(b) voronoi map</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">group</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-variable">length</span>(<span class="cm-variable">vor</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mypolys</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">lapply</span>(<span class="cm-variable">group</span>,<span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tmp</span> <span class="cm-operator">=</span> <span class="cm-variable">intersect</span>(<span class="cm-variable">dataProjected</span>, <span class="cm-variable">vor</span>[<span class="cm-variable">x</span>,])<span class="cm-semi">;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_pi</span><span class="cm-operator">=</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">tmp</span>)[<span class="cm-variable">c</span>(<span class="cm-string">'long'</span>,<span class="cm-string">'lat'</span>,<span class="cm-string">'group'</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_pi</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">city</span><span class="cm-operator">=</span><span class="cm-variable">as.character</span>(<span class="cm-variable">vor</span>[<span class="cm-variable">x</span>,]@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">city</span>[<span class="cm-number">1</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_pi</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">as.numeric</span>(<span class="cm-variable">df_pi</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">group</span>)<span class="cm-operator">+</span><span class="cm-variable">runif</span>(<span class="cm-number">1</span>,<span class="cm-number">0</span>,<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">df_pi</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_vor</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">data.frame</span>(<span class="cm-variable">long</span><span class="cm-operator">=</span><span class="cm-variable">numeric</span>(<span class="cm-number">0</span>),<span class="cm-variable">lat</span><span class="cm-operator">=</span><span class="cm-variable">numeric</span>(<span class="cm-number">0</span>),<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">numeric</span>(<span class="cm-number">0</span>),<span class="cm-variable">city</span><span class="cm-operator">=</span><span class="cm-variable">character</span>(<span class="cm-number">0</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">group</span> ){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">df_vor</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">rbind</span>(<span class="cm-variable">df_vor</span>,<span class="cm-variable">mypolys</span>[[<span class="cm-variable">i</span>]])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_vor</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">city</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">color</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>, <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.5</span>,<span class="cm-variable">alpha</span><span class="cm-operator">=</span><span class="cm-number">0.6</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">dati</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span>, <span class="cm-variable">y</span>),<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">4</span>,<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>,<span class="cm-variable">color</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"red"</span>,<span class="cm-variable">stroke</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1276px;"></div></div></div></pre><center class="half">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308001204355.png" alt="image-20210308001204355" width="300">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308001133165.png" alt="image-20210308001133165" width="300">
 </center><p><span>                                   (a).     Voronoi diagram                                 (b). Voronoi map</span></p><h5><a name="17-connection-map" class="md-header-anchor"></a><span>1.7 Connection map</span></h5><p><span>Connection map is a method using straight lines or curves to connect locations on a map. It shows different routes (</span><strong><span>Figure a</span></strong><span> and </span><strong><span>Figure b</span></strong><span>). In addition, through analyzing the connection or distribution on a given map, we can have a better understanding of its spatial pattern. </span></p><p><span>The most common connection map is the flight route map with origins and destinations of each flight, so there will be a lot of overlaps. To avoid this situation, we can set transparency of lines.</span></p><p><span>Flow map can show the movements information. Each flow has its origin and destination, and its values as well. The values can be shown by the width of lines (</span><strong><span>Figure c</span></strong><span>). Sometimes, arrows can be added to show the directions clearly (</span><strong><span>Figure d</span></strong><span>). </span></p><p><span>The geom_curve() function from ggplot2 package defines origin (x, y) and destination (xend, yend) and therefore connects two dots. The curvature can control the bending degree, and the arrow can control the size of arrows.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">rgdal</span>) &nbsp; <span class="cm-comment">#readOGR()</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">tidyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map1.shp"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_map</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>, <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"id"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_city</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_City.csv"</span>) [<span class="cm-variable">c</span>(<span class="cm-string">'long'</span>,<span class="cm-string">'lat'</span>,<span class="cm-string">'city'</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_connect</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_Connect.csv"</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_connect</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">df_connect</span> <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">left_join</span>(<span class="cm-variable">df_city</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-string">'start'</span><span class="cm-operator">=</span><span class="cm-string">'city'</span>))<span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">left_join</span>(<span class="cm-variable">df_city</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-string">'end'</span><span class="cm-operator">=</span><span class="cm-string">'city'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(a) connection map with straight lines</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_curve</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_connect</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long.x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat.x</span>,<span class="cm-variable">xend</span><span class="cm-operator">=</span><span class="cm-variable">long.y</span>,<span class="cm-variable">yend</span><span class="cm-operator">=</span><span class="cm-variable">lat.y</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.75</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">curvature</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span><span class="cm-variable">df_connect</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long.y</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat.y</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">4</span>,<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"#F00000"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">stroke</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(b)connection map with curves</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_curve</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_connect</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long.x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat.x</span>,<span class="cm-variable">xend</span><span class="cm-operator">=</span><span class="cm-variable">long.y</span>,<span class="cm-variable">yend</span><span class="cm-operator">=</span><span class="cm-variable">lat.y</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.75</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">curvature</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span><span class="cm-variable">df_connect</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long.y</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat.y</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">4</span>,<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"#F00000"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">stroke</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(c) flow map without arrow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_curve</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_connect</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long.x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat.x</span>,<span class="cm-variable">xend</span><span class="cm-operator">=</span><span class="cm-variable">long.y</span>,<span class="cm-variable">yend</span><span class="cm-operator">=</span><span class="cm-variable">lat.y</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-variable">start</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-variable">value</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">curvature</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_size</span>(<span class="cm-variable">range</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-number">0.5</span>,<span class="cm-number">1.5</span>))<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span> <span class="cm-operator">=</span><span class="cm-variable">df_connect</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long.y</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat.y</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">4</span>,<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">21</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">stroke</span><span class="cm-operator">=</span><span class="cm-number">0.5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(d) flow map with arrow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">long</span>, <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-variable">lat</span>,<span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_curve</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_connect</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long.x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat.x</span>,<span class="cm-variable">xend</span><span class="cm-operator">=</span><span class="cm-variable">long.y</span>,<span class="cm-variable">yend</span><span class="cm-operator">=</span><span class="cm-variable">lat.y</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-variable">value</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-variable">start</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">arrow</span> <span class="cm-operator">=</span> <span class="cm-variable">arrow</span>(<span class="cm-variable">length</span> <span class="cm-operator">=</span> <span class="cm-variable">unit</span>(<span class="cm-number">0.25</span>, <span class="cm-string">"cm"</span>)),<span class="cm-variable">curvature</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_size</span>(<span class="cm-variable">range</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-number">0.5</span>,<span class="cm-number">1.5</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1056px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1056px;"></div></div></div></pre><center class="half">
   <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308193010873.png" alt="image-20210308193010873" width="300">
<img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308193043817.png" alt="image-20210308193043817" width="300">
 </center><p><span>                              (a) connection map with straight lines      (b) connection map with curves</span></p><center class="half">
   <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308193223309.png" alt="image-20210308193223309" width="300">
<img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308193246674.png" alt="image-20210308193246674" width="300">
 </center><p><span>                                  (c) flow map without arrow                  (d) flow map with arrow</span></p><h5><a name="18-isopleth-map" class="md-header-anchor"></a><span>1.8 Isopleth map</span></h5><p><span>Isopleth maps simplify information about a region by  showing areas with continuous distribution. Isopleth maps may use lines  to show areas where elevation, temperature, rainfall, or some other  quality is the same; values between lines can be interpolated. Isopleths may also use color to show regions where some quality is the same; for  example, a map that use shades from red to blue to indicate temperature  ranges. An isopleth differs from a choropleth because the lines or  regions are determined by the data rather than conforming to a  predefined area, such as a political subdivision.</span></p><p><span>This type of map is ideal for showing gradual change over space and avoids the abrupt changes which boundary lines produce on choropleth maps. Temperature, for example, is a phenomenon that should be mapped using isoplething, since temperature exists at every point (is continuous), yet does not change abruptly at any point (like population density may do as you cross into another census zone). Relief maps should always be in isopleth form for this reason.</span></p><p><span>There are two main types of isopleth map in R. In terms of displayed area, it can be divided into local isopleth maps and global isopleth maps. The first method can be implemented by geom_contour() function in ggplot2 in R, directly draw and overlay layers of contour lines based on data. The second method is to use geom_tile() or geom_raster() function and do interpolation processing to get data of whole map. Then we draw the thermodynamic plot.</span></p><h6><a name="choropleth-maps-drawing-n190" class="md-header-anchor"></a><span>Choropleth maps drawing</span></h6><p><span>To draw a two-dimensional kernel density equipotential map, first use the sm.density function in the sm package to calculate the two-dimensional kernel density distribution map based on the scattered point distribution data, and then convert the two-dimensional kernel density distribution data into SpatialPixelsDataFrame format data, use The !is.na() function calculates the overlap area of the two-dimensional kernel density distribution map and the map in SpatialPolygonsDataFrame format. Finally, the geom_raster() and geom_contour() functions are used to draw the heat map and contour lines.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">rgdal</span>) &nbsp; <span class="cm-comment">#readOGR()</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">RColorBrewer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">sm</span>) <span class="cm-comment">#sm.density</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colormap</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">colorRampPalette</span>(<span class="cm-variable">rev</span>(<span class="cm-variable">brewer.pal</span>(<span class="cm-number">11</span>,<span class="cm-string">'Spectral'</span>)))(<span class="cm-number">32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readOGR</span>(<span class="cm-string">"Virtual_Map0.shp"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">id</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">watershedPoints</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fortify</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_map</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">full_join</span>(<span class="cm-variable">watershedPoints</span>, <span class="cm-variable">dataProjected</span>@<span class="cm-variable">data</span>, <span class="cm-variable">by</span> <span class="cm-operator">=</span> <span class="cm-string">"id"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_huouse</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">read.csv</span>(<span class="cm-string">"Virtual_huouse.csv"</span>) &nbsp;</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>()<span class="cm-operator">+</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_polygon</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'white'</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_point</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_huouse</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>),<span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-number">19</span>,<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">1</span>,<span class="cm-variable">alpha</span><span class="cm-operator">=</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cycle_dens</span><span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">sm.density</span>(<span class="cm-variable">data.frame</span>(<span class="cm-variable">df_huouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">long</span>, <span class="cm-variable">df_huouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">lat</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">display</span><span class="cm-operator">=</span> <span class="cm-string">"image"</span>, <span class="cm-variable">ngrid</span><span class="cm-operator">=</span><span class="cm-number">500</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ylim</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-number">30</span>,<span class="cm-number">60</span>),<span class="cm-variable">xlim</span><span class="cm-operator">=</span><span class="cm-variable">c</span>(<span class="cm-number">105</span>,<span class="cm-number">135</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Density_map</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">SpatialPoints</span>(<span class="cm-variable">expand.grid</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">cycle_dens</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">eval.points</span>[,<span class="cm-number">1</span>], </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">cycle_dens</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">eval.points</span>[,<span class="cm-number">2</span>]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Density_map</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">SpatialPixelsDataFrame</span>(<span class="cm-variable">Density_map</span>, <span class="cm-variable">data.frame</span>(<span class="cm-variable">kde</span> <span class="cm-operator">=</span> <span class="cm-variable">array</span>(<span class="cm-variable">cycle_dens</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">estimate</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">length</span>(<span class="cm-variable">cycle_dens</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">estimate</span>))))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(b)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_density</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">data.frame</span>(<span class="cm-variable">Density_map</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>(<span class="cm-variable">df_density</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>,<span class="cm-variable">z</span><span class="cm-operator">=</span><span class="cm-variable">kde</span>))<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_tile</span>(<span class="cm-variable">aes</span>(<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">kde</span>))<span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_fill_gradientn</span>(<span class="cm-variable">colours</span><span class="cm-operator">=</span><span class="cm-variable">colormap</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#stat_contour(aes(colour= ..level..),breaks=breaks_lines,color="black")+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">labs</span>(<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-string">'kde'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-string">'long'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-string">'lat'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#(c)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">group</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-variable">length</span>(<span class="cm-variable">dataProjected</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mypolys</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">lapply</span>(<span class="cm-variable">group</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tmp</span> <span class="cm-operator">=</span> <span class="cm-operator">!</span><span class="cm-variable">is.na</span>(<span class="cm-variable">over</span>(<span class="cm-variable">Density_map</span>, <span class="cm-variable">dataProjected</span>[<span class="cm-variable">x</span>,]))<span class="cm-semi">;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clipped_grid</span><span class="cm-operator">=</span> <span class="cm-variable">Density_map</span>[<span class="cm-variable">tmp</span>[,<span class="cm-number">1</span>],]<span class="cm-semi">;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clipped_grid</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">df_density</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">data.frame</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">numeric</span>(<span class="cm-number">0</span>),<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">numeric</span>(<span class="cm-number">0</span>),<span class="cm-variable">kde</span><span class="cm-operator">=</span><span class="cm-variable">numeric</span>(<span class="cm-number">0</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">group</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">df_density</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">rbind</span>(<span class="cm-variable">df_density</span>,<span class="cm-variable">cbind</span>(<span class="cm-variable">mypolys</span>[[<span class="cm-variable">i</span>]]@<span class="cm-variable">coords</span>,<span class="cm-variable">mypolys</span>[[<span class="cm-variable">i</span>]]@<span class="cm-variable">data</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_z</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">min</span>(<span class="cm-variable">df_density</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">kde</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">max_z</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">max</span>(<span class="cm-variable">df_density</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">kde</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">breaks_lines</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">seq</span>(<span class="cm-variable">min_z</span>,<span class="cm-variable">max_z</span>,<span class="cm-variable">by</span><span class="cm-operator">=</span>(<span class="cm-variable">max_z</span><span class="cm-operator">-</span><span class="cm-variable">min_z</span>)<span class="cm-operator">/</span><span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggplot</span>() <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_raster</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_density</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>,<span class="cm-variable">fill</span><span class="cm-operator">=</span><span class="cm-variable">kde</span>))<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_contour</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_density</span>,<span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">y</span>,<span class="cm-variable">z</span><span class="cm-operator">=</span><span class="cm-variable">kde</span>),<span class="cm-variable">color</span><span class="cm-operator">=</span><span class="cm-string">"white"</span>,<span class="cm-variable">breaks</span><span class="cm-operator">=</span><span class="cm-variable">breaks_lines</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_fill_gradientn</span>(<span class="cm-variable">colours</span><span class="cm-operator">=</span><span class="cm-variable">colormap</span>)<span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geom_path</span>(<span class="cm-variable">data</span><span class="cm-operator">=</span><span class="cm-variable">df_map</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">long</span>, <span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">lat</span>, <span class="cm-variable">group</span><span class="cm-operator">=</span><span class="cm-variable">group</span>),<span class="cm-variable">colour</span><span class="cm-operator">=</span><span class="cm-string">"black"</span>,<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">0.25</span>)<span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">coord_cartesian</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1144px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1144px;"></div></div></div></pre><p>&nbsp;</p><center class="half">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308103218056.png" alt="image-20210308103218056" width="300">
    <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308103301170.png" alt="image-20210308103301170" width="300">
 </center><p><span>                                    (a)        dot map                     </span><span>				</span><span>(b)2-d interpolation heat diagram</span></p><center class="half">
  <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308103433590.png" alt="image-20210308103433590" width="300">
  <img src="/Users/liuzihao/Library/Application Support/typora-user-images/image-20210308103821581.png" alt="image-20210308103821581" width="300">
 </center><p><span>				</span><span>(c)  2-d interplation estimation heat map</span><span>	</span><span>(d) 2-d interpolation isopleth maps</span></p></div>
</body>
</html>